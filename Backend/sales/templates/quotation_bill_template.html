{% load static %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <style>
    @page {
      size: A4;
      margin:7mm;
    }

    body {
      font-family: sans-serif;
      background: white;
      color: black;
      padding: 0;
      margin: 0;
      font-size: 12px;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    .card {
      border: 1px solid #000;
      border-radius: 6px;
      margin: 0 auto;
      width: 190mm;
      padding: 5mm;
      box-sizing: border-box;
      overflow: hidden;
      break-inside: avoid;
      page-break-after: always; /* Ensure each card ends on its own page */
    }

    .card-content {
      padding: 1px;
      font-size: 11px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 10pt;
      break-inside: auto; /* Allow table to break across pages */
      page-break-inside: auto;
      border-color: #000000 !important;
    }

    tr {
      break-inside: avoid; /* Prevent row breaking where possible */
      break-after: auto;
    }

    th, td {
      border: 1px solid #000000 !important;
      padding: 2pt;
      vertical-align: bottom;
      color: #000000 !important;
      background: #FFFFFF !important;
    }

    th {
      font-weight: 600;
      background: #f5f5f5 !important;
    }

    h1, h2 {
      margin: 0;
      padding: 0;
    }

    h1 {
      font-size: 24px;
      border-bottom: 2px solid #000;
      padding-bottom: 4px;
    }

    h2 {
      font-size: 24pt;
      font-weight: bold;
      text-align: center;
      margin-bottom: 16pt;
      border-bottom: 2px solid #000;
      letter-spacing: 1px;
      break-after: avoid; /* Prevent page break after heading */
    }

    .mt-4 {
      margin-top: 12px;
    }

    .mt-6 {
      margin-top: 16px;
    }

    .mb-2 {
      margin-bottom: 6px;
    }

    .ml-5 {
      margin-left: 18px;
    }

    .text-sm {
      font-size: 11px;
    }

    .text-right {
      text-align: right;
    }

    .text-left {
      text-align: left;
    }

    .text-center {
      text-align: center;
    }

    .font-bold {
      font-weight: 700;
    }

    .font-semibold {
      font-weight: 600;
    }

    .list-decimal {
      list-style-type: decimal;
      margin-left: 18px;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="card-content text-sm">
      <!-- Company Info and Logo -->
      <table style="margin-bottom: 1rem; font-size: 0.9rem; border-collapse: collapse;">
        <tbody>
          <tr>
            <td class="border px-3 py-1 align-top" style="text-align: center;">
              <div style="display: flex; align-items: center; justify-content: center; gap: 16px;">
                <img src="data:image/png;base64,{{ logo_base64 }}" alt="Company Logo" style="height: 40px; width: auto;" />
                <h1 class="font-bold" style="font-size: 24pt;">Milestone</h1>
              </div>
            </td>
            <td class="border px-3 py-1 align-top company-info text-sm" style="width: 50%; text-align: left;">
              <p style="margin: 0;">69/2, Vikas Nagar, Devpuri, Raipur CG, 492015</p>
              <p style="margin: 0;">India, Ph: 0771-4020500, 7587777550/51/52</p>
              <p style="margin: 0;">Email: milestonessoftech@gmail.com</p>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- TAX-INVOICE Heading -->
      <h2>TAX-INVOICE</h2>

      <!-- Invoice and Party Details -->
      <table style="font-size: 0.9rem; border-collapse: collapse; width: 100%;">
        <tbody>
          <tr>
            <td style="border: 1px solid #000000; text-align: left;">
              <strong>Invoice No:</strong> {{ bill.invoiceNo|default:"N/A" }}
            </td>
            <td colspan="3" style="border: 1px solid #000000; text-align: right;">
              <strong>Date:</strong> {{ date }}
            </td>
          </tr>
          <tr>
            <td style="border: 1px solid #000000; text-align: left;">
              <strong>Party Name:</strong> {{ quotation.customerName|default:"N/A" }}
            </td>
            <td colspan="3" style="border: 1px solid #000000; text-align: left;">
              <strong>Address:</strong> {{ quotation.address|default:"N/A" }}
            </td>
          </tr>
          <tr>
            <td style="border: 1px solid #000000; text-align: left;">
              <strong>GST No:</strong>
            </td>
            <td style="border: 1px solid #000000; text-align: right;">22AAALM0982ZJ</td>
            <td style="border: 1px solid #000000; text-align: right;">
              <strong>State code:</strong>
            </td>
            <td style="border: 1px solid #000000; text-align: right;">22</td>
          </tr>
          <tr>
            <td style="border: 1px solid #000000; text-align: left;">
              <strong>Kind Attention:</strong>
            </td>
            <td colspan="3" style="border: 1px solid #000000; text-align: right;">
              
            </td>
          </tr>
          <tr>
            <td style="border: 1px solid #000000; text-align: left;">
              <strong>Work Order No.</strong>
            </td>
            <td style="border: 1px solid #000000; text-align: left;">
              <strong>Date</strong> {{ date }}
            </td>
            <td style="border: 1px solid #000000; text-align: left;">
              <strong>Payment Terms</strong>
            </td>
            <td style="border: 1px solid #000000; text-align: left;">
              <strong>Other Comments</strong>
            </td>
          </tr>
          <tr>
            <td colspan="2" style="border: 1px solid #000000; text-align: left;">
              No.{{ bill.workOrderNo|default:"N/A" }}
            </td>
            <td style="border: 1px solid #000000; text-align: left;">As per Order/Full</td>
            <td style="border: 1px solid #000000; text-align: left;">{{ bill.comments|default:"N/A" }}</td>
          </tr>
        </tbody>
      </table>

      <!-- Quotation Items and Services -->
      <div style="overflow-x: auto;" class="mt-4">
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th class="border px-2 py-1">No.</th>
              <th class="border px-2 py-1">Description</th>
              <th class="border px-2 py-1">Qty</th>
              <th class="border px-2 py-1">Rate</th>
              <th class="border px-2 py-1">Amount</th>
            </tr>
          </thead>
          <tbody>
            {% if not items and not services %}
              <tr>
                <td colspan="5" class="py-2 px-2 text-center">No quotation items or services found</td>
              </tr>
            {% else %}
              {% for item in items %}
                <tr>
                  <td class="border px-2 py-1">{{ forloop.counter }}</td>
                  <td class="border px-2 py-1">{{ item.product_name }}</td>
                  <td class="border px-2 py-1">{{ item.quantity }}</td>
                  <td class="border px-2 py-1">{{ item.unit_price }}</td>
                  <td class="border px-2 py-1">{{ item.total|floatformat:2 }}</td>
                </tr>
              {% endfor %}
              {% with items|length as offset %}
                {% for service in services %}
                  <tr>
                    <td class="border px-2 py-1">{{ forloop.counter|add:offset }}</td>
                    <td class="border px-2 py-1">
                      <strong>{{ service.name }}</strong> ({{ service.description }})
                    </td>
                    <td class="border px-2 py-1">1</td>
                    <td class="border px-2 py-1">{{ service.rate }}</td>
                    <td class="border px-2 py-1">{{ service.rate|floatformat:2 }}</td>
                  </tr>
                {% endfor %}
              {% endwith %}
              <tr class="font-semibold">
                <td colspan="4" class="border px-2 py-1 text-right">Total</td>
                <td class="border px-2 py-1">{{ total_amount|floatformat:2 }}</td>
              </tr>
              {% if bill.otherTax or bill.otherCharges %}
                {% for tax in bill.otherTax %}
                  <tr>
                    <td class="border px-2 py-1"></td>
                    <td colspan="3" class="border px-2 py-1 text-right">
                      {{ tax.tax_NameOrType }} {{ tax.value }}%
                    </td>
                    <td class="border px-2 py-1">{{ tax.amount|floatformat:2 }}</td>
                  </tr>
                {% endfor %}
                {% for charge in bill.otherCharges %}
                  <tr>
                    <td class="border px-2 py-1"></td>
                    <td colspan="3" class="border px-2 py-1 text-left">{{ charge.Description }}</td>
                    <td class="border px-2 py-1">{{ charge.rate|floatformat:2 }}</td>
                  </tr>
                {% endfor %}
              {% endif %}
              <tr class="font-semibold">
                <td colspan="4" class="border px-2 py-1 text-right">Grand Total</td>
                <td class="border px-2 py-1">{{ grand_total|floatformat:2 }}</td>
              </tr>
              <tr class="font-semibold">
                <td colspan="4" class="border px-2 py-1 text-right">
                  GST ({{ quotation.tax|default:0 }}%)
                </td>
                <td class="border px-2 py-1">{{ gst_amount|floatformat:2 }}</td>
              </tr>
              <tr class="font-semibold">
                <td colspan="4" class="border px-2 py-1 text-right">Net Amount</td>
                <td class="border px-2 py-1">{{ net_amount|floatformat:2 }}</td>
              </tr>
              <tr class="font-semibold">
                <td colspan="4" class="border px-2 py-1 text-right">Round Off</td>
                <td class="border px-2 py-1">{{ round_off|floatformat:2 }}</td>
              </tr>
              <tr class="font-semibold">
                <td colspan="4" class="border px-2 py-1 text-right">Net Payable</td>
                <td class="border px-2 py-1">{{ net_payable|floatformat:2 }}</td>
              </tr>
              <tr class="font-semibold">
                <td colspan="5" class="border px-2 py-1 text-right">Amount In Words: {{ amount_in_words|upper }} RUPEES ONLY</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>

      <!-- Company and Bank Details -->
      <table style="font-size: 0.9rem; border-collapse: collapse;">
        <tbody>
          <tr>
            <td class="border px-2 py-1 align-top" style="text-align: left;">
              <strong>Company GST No:</strong>
            </td>
            <td class="border px-2 py-1 align-top" colspan="3" style="text-align: left;">
              22AAALM0982ZJ
            </td>
            <td class="border px-2 py-1 align-top" colspan="1" style="text-align: left;">
              <strong>Bank A/c Details:</strong>
            </td>
          </tr>
          <tr>
            <td class="border px-2 py-1 align-top" style="text-align: left;">
              <strong>Company State Code:</strong>
            </td>
            <td class="border px-2 py-1 align-top text-center" colspan="2">
              22
            </td>
            <td class="border px-2 py-1 align-top" colspan="1" style="text-align: left;">
              <strong>A/C Name:</strong>
            </td>
            <td class="border px-2 py-1 align-top" style="text-align: left;">
              MILESTONE SOFT TECH PVT LTD RAIPUR
            </td>
          </tr>
          <tr>
            <td class="border px-2 py-1 align-top" style="text-align: left;">
              <strong>Company's Pan No:</strong>
            </td>
            <td class="border px-2 py-1 align-top text-center" colspan="3">
              AAGCM418P2Z2
            </td>
            <td class="border px-2 py-1 align-top" colspan="3" style="text-align: left;">
              <strong>A/C No:</strong> 86950500000005
            </td>
          </tr>
          <tr>
            <td class="border px-2 py-1 align-top" style="text-align: left;">
              <strong>Service Tax No:</strong>
            </td>
            <td class="border px-2 py-1 align-top" colspan="3"></td>
            <td class="border px-2 py-1 align-top" colspan="3" style="text-align: left;">
              <strong>IFSC CODE:</strong> BARB0DBPUCH
            </td>
          </tr>
          <tr>
            <td class="border px-2 py-1 align-top" style="text-align: left;"></td>
            <td class="border px-2 py-1 align-top" colspan="3"></td>
            <td class="border px-2 py-1 align-top" colspan="3" style="text-align: left;">
              <strong>BANK NAME:</strong> BANK OF BARODA, PACHPEDI NAKA, RAIPUR
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Declaration -->
      <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;" class="mb-2">
        <thead>
          <tr>
            <th class="border px-2 py-1 text-left">Declaration:</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="border px-3 py-2">
              <ol class="ml-5 list-decimal">
                <li>We Declare that this invoice shows the actual price of the goods/services described.</li>
                <li>Cheque and demand drafts to be favour of Milestone Soft Tech Pvt Ltd. Raipur</li>
                <li>All disputes are subject to Raipur jurisdiction.</li>
              </ol>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Authorized Signatory -->
      <div class="text-right font-semibold mt-6">
        <p>Authorized Signatory</p>
      </div>
    </div>
  </div>
</body>
</html>